# 실행 컨텍스트

## 1\. 소스코드의 타입

소스코드의 타입에 따라 실행 컨텍스트를 생성하는 과정과 관리 내용이다르다.

**전역코드**

- 전역 스코프를 생성해야 한다.
- var 키워드로 선언된 전역변수와 함수 선언문으로 선언된 전역함수를 전역객체의 프로퍼티와 메서드로 바인딩하고 참조하기 위해 전역 객체와 연결되어야 한다.
- 전역 실행 컨텍스트 생성

**함수코드**

- 지역 스코프를 생성하고 지역 변수, 매개변수, arguments 객체를 관리해야 한다.
- 지역 스코프를 스코프 체인으로 연결해야한다.
- 함수 실행 컨텍스트 생성

**eval 코드**

- strict mode에서 스코프 생성
- eval 실행 컨텍스트 생성

**모듈 코드**

- 모듈스코프 생성
- 모듈 실행 컨텍스트 생성

## 2\. 소스코드의 평가와 실행

자바스크립트 엔진은 소스코드의 평과와 소스코드의 실행과정으로 나누어 처리한다.

**소스코드의 평가**

- 실행 컨텍스트 생성
- 변수, 함수 등의 선언문만 먼저 실행하여 생성된 변수나 식별자를 실행 컨텍스트가 관리하는 스코프에 등록

**소스코드의 실행**

- 선언문을 제외한 소스코드 순차적으로 실행
- 변수, 함수의 참조를 실행 컨텍스트가 관리하는 스코프에서 검색
- 변수 값 변경 등 실행 결과를 실행 컨텍스트가 관리하는 스코프에 등록

## 3\. 실행 컨텍스트의 역할

### 평가와 실행 순서

**전역 코드 평가** 선언문만 먼저 실행, 전역 스코프에 등록, var 키워드로 선언한 전역변수와 함수 선언문으로 정의된 전                        역함수는 전역 객체의 프로퍼티와 메서드가 됨.

↓

**전역 코드 실행** 전역 변수에 값이 할당, 함수 호출, 전역 코드 실행 일시 중단 후 함수 내부로 진입

↓

**함수 코드 평가** 매개변수, 지역 변수 선언문 실행되어 지역 스코프 등록, argumennts 객체 생성되어 지역 스코프 등록,                        this 바인딩 결정

↓

**함수 코드 실행** 매개변수, 지역 변수 값이 할당, console.log 메서드 호출, 스코프 체인 통해 검색

### 결론

**코드가 실행되려면 스코프, 식별자, 코드 실행 순서 등의 관리가 필요하다**

- 선언에 의해 생성된 모든 식별자를 스코프를 구분하여 등록하고 상태변화 관리를 지속적으로 해야한다.
- 스코프 체인을 형성해야한다. 식별자 검색할 수 있어야 한다.
- 코드의 실행 순서를 변경 할 수 있고 되돌아 갈 수도 있어야 한다.

#### 실행 컨텍스트의 역할

<u>실행 컨텍스트는 소스코드를 실행하는 데 필요한 환경을 제공하고 코드의 실행 결과를 실제로 관리하는 영역이다.</u>

<u>**식별자**와 **스코프**는 실행컨텍스트의 _**렉시컬 환경**_, **코드 실행 순서**는 **_실행 컨텍스트 스택_**으로 관리한다.</u>

## 4\. 실행 컨텍스트의 스택

**실행 컨텍스트 스택** : 생성된 실행 컨텍스트가 스택자료구조를 관리하는 것.

- 스택에는 코드가 실행되는 것에 따라 실행 컨텍스트가 추가되고 제거된다.
- 코드의 실행 순서 관리
- 최상위에 존재하는 실행 컨텍스트는 현재 실행 중인 코드의 실행 컨텍스트이다.

## 5\. 렉시컬 환경

<u>식별자와 식별자에 바인딩된 값, 상위 스코프에 대한 참조를 기록하는 자료구조로 실행 컨텍스트를 구성하는 컴포넌트.</u>

**두 개의 컴포넌트로 구성된다.**

1.  환경레코드 Environment Record => 스코프에 포함된 식별자를 등록하고 식별자에 바인딩된 값을 관리하는 저장소.
2.  외부 렉시컬 환경에 대한 참조 Outer Lexical Environment Reference =>해당 실행 컨텍스트를 생성한 소스코드를 포함하는 상위 코드의 렉시컬 환경. 스코프 체인 구현

## 6\. 실행 컨텍스트와 블록레벨 스코프

**var 키워드로 선언한 변수** 코드 함수의 코드블록만 지역스코프로 인정하는 함수 레벨스코프

**let, const 키워드로 선언한 변수** 모든 코드블록을 지역 스코프로 인정하는 블록 레벨 스코프

#### 블록 레벨 스코프 => 선언적 환경 레코드를 갖는다.

- 선언적 환경 레코드를 갖는 렉시컬 환경을 새롭게 생성하여 기존의 전역 렉시컬 환경을 교체한다. =>블록 레벨 스코프를 생성하는 모든 블록문에 적용.
- 외부 렉시컬 환경에 대한 참조는    블록 레벨 스코프를 생성하기 이전의 전역 레시컬 환경을 가리킴.
- 변수 선언문에 let 을 사용한 for문은 코드 블록이 반복해서 실행될 때마다 코드 블록을 위한 새로운 렉시컬 환경 생성. => 독립적인 렉시컬 환경을 생성하여 식별자의 값을 유지

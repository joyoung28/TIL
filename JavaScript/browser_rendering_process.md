# 브라우저의 렌더링 과정

**파싱** : 프로그래밍 문법에 맞게 작성된 텍스트 문서를 읽어 텍스트 문서의 문자열을 토큰으로 분해하고, 파스트리를 생성하는 과정.

**렌더링** : 문서를 파싱하여 브라우저에 시각적으로 출력하는 것.

### 렌더링 과정

1\. 브라우저는 렌더링에 필요한 필요한 리소스를 요청하고, 서버로부터 응답을 받는다

2\. 응답된 HTML, CSS 파싱하여 DOM, CSSOM 생성 -> 결합하여 렌더트리 생성

3\. 자바스크립트 엔진은 응답된 자바스크립트 파싱하여 AST 생성, 바이트코드로 변환하여 실행, 자바스크립트는 DOM API를 통해 DOM, CSSOM 변경 가능 -> 변경된 DOM, CSSOM은 다시 렌더트리로 결합

4\. 렌더트리를 기반으로 HTML 요소의 레이아웃 계산, 브라우저 화면에 HTML 요소를 페인팅

## HTTP 1.1 과 HTTP2.0

<u>HTTP : 웹에서 브라우저와 서버가 통신하기 위한 프로토콜(규약)이다.</u>

### HTTP/1.1 

- 커넥션당 하나의 요청과 응답만 처리한다.
- 리소스 요청과 응답이 개별적으로 전송된다.
- 동시 전송이 불가능해 요청할 리소스가 많아지면 응답 시간이 증가한다.

### HTTP/2

- 커넥션당 여러 개의 요청과 응답이 가능하다.
- 동시 전송이 가능해 HTTP/1.1 보다 페이지 로드 속도가 약 50% 빠르다.

## HTML 파싱과 DOM(Document Object Model) 생성

1\. HTML 문서를 파싱하여 DOM을 생성한다.

2\. DOM은 노드들로 구성된 트리 자료구조이다.

3\. HTML 파싱 과정 => 바이트 -> 문자 -> 토큰 -> 노드 -> DOM

## CSS파싱과 CSSOM(CSS Object Model) 생성

1\. CSS를 로드하는 link, style 태그가 있으면 DOM 생성 일시 중지

2\. CSS를 HTML과 동일한 과정으로 파싱하여 CSSOM 생성

3\. CSS 파싱 완료 후 중단된 지점부터 HTML을 파싱하여 다시 DOM 생성

4\. CSSOM은 CSS의 상속을 반영하여 생성.

## 렌더트리 생성

- DOM과 CSSOM은 렌더링을 위해 렌더 트리로 결합된다.
- 렌더 트리 : 렌더링을 위한 트리 구조의 자료, 브라우저 화면에 렌더링되는 노드만으로 구성
- HTML 요소의 레이아웃을 계산하는데 사용.
- 브라우저 화면에 픽셀을 렌더링하는 페인팅 처리에 입력된다.

## 자바스크립트 파싱과 실행

- DOM은 HTML 문서의 구조, 정보 뿐만아니라 DOM API를 제공한다.
- DOM API : HTML 요소와 스타일 등 변경할 수 있는 프로그램이 인터페이스.
- 자바스크립트 파싱과 실행은 자바스크립트 엔진이 처리한다.
- 자바스크립트 코드를 파싱하여 AST(추상적 구문 트리) 생성
- AST를 기반으로 인터프리터가 실행할 수 있는 중간 코드인 바이트코드 생성하여 실행

## 리플로우 리페인트

<u>DOM API가 사용되어 DOM이나 CSSOM이 변경된 경우 DOM과 CSSOM은 렌더 트리로 다시 결합되고 변경된 렌더 트리를 기반으로 레이아웃가 페인트 과정을 거쳐 브라우저의 화면에 다시 렌더링하는 과정.</u>

**리플로우** : 레이아웃 계산을 다시 하는 것, 레이아웃에 영향을 주는 변경이 발생한 경우에 실행.

**리페인트** : 재결합된 렌더 트리를 기반으로 다시 페인트하는 것.

## 자바스크립트를 맨 아래 위치시키는 이유

- 브라우저는 위에서 아래 방향으로 순차적으로 파싱하고 실행한다. script의 위치에 따라 HTML파싱이 방해되어 DOM 생성이 지연될 수 있다.
- 자바스크립트에서 DOM API를 사용할 경우 DOM이나 CSSOM이 이미 생성되어 있어야 한다.  생성되어 있지 않으면  에러가 발생된다.
- DOM 생성이 완료되고 자바스크립트가 실행되어 렌더링 되므로 페이지 로딩 시간이 단축된다.

## script 태그의 async/defer 어트리뷰트

<u>자바스크립트 파싱에 의한 DOM 생성 중단되는 문제를 해결하기 위해 HTML5 부터 async, defer 어트리뷰트 추가되었다</u>

```
<script async src="extern.js"></script>
<script defer src="extern.js"></script>
```

- src 어트리뷰트를 통해 외부 자바스크립트 파일을 로드하는 경우에만 사용가능.
- HTML 파싱과 외부 자바스크립트 파일의 로드가 비동기적으로 동시에 진행.

**async**

- HTML 파싱과 외부 자바스크립트 파일의 로드가 비동기적으로 동시 진행.
- 자바스크립트 파싱, 실행은 자바스크립트 파일의 로드가 완료된 직후 진행되며 이때 HTML 파싱이 중단.
- 여러 개의 script에 async를 지정하면 script 순서와는 상관없이 로드가 완료된 자바스크립부터 먼저 실행.

**defer**

- HTML 파싱과 외부 자바스크립트 파일의 로드가 비동기적으로 동시 진행.
- 자바스크립트 파싱, 실행은 HTML파싱이 완료된 직후 진행된다.
- DOM 생성 완료 후 실행 될 자바스크립트에 유용
